---
title: '"Weniger Besucher als gewöhnlich"'
author: "Markus Konrad"
date: "March 31, 2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r, warning=FALSE, message=FALSE}
source('dataprep.R')
source('plotting.R')

pop <- load_pop_data()
collection_time <- range_collection_time(pop)
cities <- distinct(pop, iso2, city, lat, lng)
pop <- select(pop, -utc_date, -utc_hour, -lat, -lng)

pop_approx <- group_by(pop, local_day, place_id) %>%
    do(interpolate_per_place(.)) %>% ungroup()

# also remove hardware stores (too few samples)
popeur <- filter(pop, region == 'Europe', category != 'hardware stores') %>% select(-region)
popeur_approx <- filter(pop_approx, region == 'Europe', category != 'hardware stores') %>% select(-region)
```

Viele Menschen senden über ihr Smartphone – ob wissentlich oder nicht – permanent ihre genaue Position an große IT-Unternehmen wie Google oder Apple. Über die datenschutzrechtlichen und gesellschaftlichen Implikationen wurde – und wird im Zuge von Corona-Tracking Apps derzeit wieder – viel diskutiert. Dennoch ist vielen Menschen nicht bewusst, dass sie mit ihren Smartphones zu einem stetig wachsendem Berg an Bewegungsdaten beitragen, welcher auf aggregierter Ebene Beobachtungen über Verhaltensmuster eines großen Teils der Bevölkerung zulässt.

Die Corona-Krise und die damit einhergehenden Maßnahmen zur Eindämmung des Virus erfordern von allen Menschen radikale Veränderungen ihrer Verhaltensmuster. Viele arbeiten von zu Hause aus, meiden wenn möglich öffentliche Verkehrsmittel, können keine Theater, Restaurants, Bars oder Fitnessstudios mehr besuchen. Es ist anzunehmen, dass sich diese Einschnitte auch in Bewegungsdaten wiederspiegeln. Diese erlauben uns aber weitergehende Fragen zu beantworten, bspw.: Welche Orte sind besonders von einem Rückgang von Besucher*innen betroffen? Gibt es eventuell auch Orte, die sogar öfter frequentiert werden, als vor den Kontaktsperren? Gibt es Unterschiede zwischen Ländern? Wie ist der zeitliche Verlauf?

Um das zu untersuchen, habe ich mir Daten von Google Maps [eig. "Google Places", aber ich glaube damit weiß niemand was anzufangen] angeschaut. Vielleicht kennen Sie den Service von Google Maps, für bestimmte Orte die Stoßzeiten anzuzeigen, also beispielsweise wie beliebt ein bestimmtes Restaurant zu einer bestimmten Zeit überlicherweise ist. Zu manchen Orten bietet Google auch einen Echtzeitwert an, also ob gerade jetzt wirklich so viele Menschen an diesem Ort sind, wie üblich [TODO: Screenshot Aussschnitt davon?]. Beides basiert auf dem eingangs erwähnten Tracking mittels dem Smartphone vieler Nutzer*innen. Momentan zeigt Google etwa für den Berliner Hauptbahnhof an: "Weniger Besucher als gewöhnlich" – was sicherlich niemanden überrascht.

Der Beliebtheitswert ist ein Prozentwert, bei dem 100% bedeutet, dass in etwa so viele Menschen vor Ort sind, wie zu dieser Zeit üblich. Interessant ist hierbei vor allem die Differenz zwischen der aktuellen Beliebtheit und der üblichen Beliebtheit zum gleichen Wochentag und zur selben Stunde. Da die übliche Beliebtheit ein über Jahre hinweg gemittelter Wert ist, ist er ein stabiler Bezugspunkt. Einschränkend muss man allerdings sagen, dass dieser Wert bei Google Maps fast ausschließlich für beliebte Orte im Zentrum großer Metropolen ermittelt wird. Somit ist die Aussagekraft auf innerstädtische Räume von Großstädten beschränkt.

Ich fragte diese Daten zwischen 22. März und 2. April für knapp 700 Lokalitäten in 110 Städten, und seit dem 3. April für fast 3000 Lokalitäten weltweit automatisiert und in regelmäßigen Abständen ab. Im folgenden möchte ich auf ein paar erste Ergebnisse eingehen. Zunächst können wir uns anschauen, wie die Differenz der Beliebtheitswerte seit dem 22. März für verschiedene Kategorien von Orten ausfällt. Wir beschränken uns zunächst auf Daten aus Europa, da hierfür die meisten Daten vorliegen und somit die Aussagekraft am höchsten ist. [Die Resultate aus einzelnen Ländern wurden nach ihrer Bevölkerungszahl gewichtet.]

```{r, fig.width=10, fig.height=5}
country_cat_means <- group_by(popeur, country, category) %>% group_means_ci(pop_diff)
cat_means <- group_by(country_cat_means, category) %>% group_means_ci(mean_pop_diff)

plot_means_errorbars(cat_means, category, mean_mean_pop_diff, lwr_mean_pop_diff, upr_mean_pop_diff,
                     'Differences in popularity score per category in Europe', collection_time)
```

[Alternative Darstellungen: Balkendiagramm oder rotiert als Säulendiagramm ohne Konf.intervalle / TODO: Beschriftungen auf deutsch]

Da generell nur Daten von Lokalitäten abgerufen wurden, welche als "gerade geöffnet" verzeichnet wurden, bezieht sich die Kategorie "Bars, Clubs und Restaurants" nur auf sehr wenige Orte. "Geschäfte" umfasst Daten von Supermärkten, Lebensmittelgeschäften, Baumärkten und Einkaufszentren, "öffentlicher Nahverkehr" umfasst ausschließlich Bahnhöfe und "Tourismus" bezieht sich auf bekannte Sehenswürdigkeiten einer Stadt sowie Touristeninformationen.

Es ist deutlich, dass sämtliche Arten von untersuchten Orten eine negative Differenz aufweisen, also weniger oft frequentiert werden, als vor der Corona-Krise. Besonders stark ist der Einbruch bei öffentlichen Verkehrsmitteln und Geschäften. Auch Supermärkte (nicht gesondert dargestellt) werden weniger frequentiert (-20%), da vermutlich weniger oft, aber dafür zu größeren Mengen eingekauft wird. Allein Parks weisen einen relativ geringen Rückgang auf.

Über den zeitlichen Verlauf betrachtet sehen wir wenig Variation, da fast überall in Europa die Maßnahmen gegen das Virus unverändert andauern. Nur am Wochenende sieht man noch stärkere Effekte im Bereich Tourismus.  [hier noch auf weitere Daten für kommendes Wochenende warten / Hinweis ab 28.3. nur noch drei mal wöchentlich Datenabfrage?]

```{r, fig.width=10, fig.height=4}
eur_low_obs_cat <- c('bars, clubs, restaurants')
popeur_filt <- filter(popeur, !(category %in% eur_low_obs_cat))
eur_low_obs_days <- group_by(popeur_filt, local_day) %>% count() %>% ungroup() %>%
    filter(n < 1000) %>% pull(local_day)
popeur_filt <- filter(popeur_filt, !(local_day %in% eur_low_obs_days))
ts_country_cat_daily_means <- group_by(popeur_filt, local_day, category, country) %>% group_means_ci(pop_diff) %>% ungroup()
ts_daily_cat_means <- group_by(ts_country_cat_daily_means, local_day, category) %>%
    group_means_ci(mean_pop_diff)

plot_ts_cat_means_ribbon(ts_daily_cat_means, local_day, mean_mean_pop_diff,
                         lwr_mean_pop_diff, upr_mean_pop_diff, category,
                         'Mean daily popularity difference per category over time in Europe',
                         collection_time, ribbon = FALSE)

```

[Hier noch mehr Daten abwarten / TODO: Beschriftungen auf deutsch]
 
Über den Tagesverlauf zeigen sich wiederkehrende Muster. Werktags bricht besonders morgens und nachmittags der Berufsverkehr in den öffentlichen Verkehrsmitteln ein und auch Geschäfte sind nach Feierabend weitaus weniger frequentiert. Parks dagegen werden in den nachmittags und frühen Abendstunden sogar stärker frequentiert, als das üblicherweise der Fall ist. Das ist auch der Fall am Wochenende. Hier ist der Einbruch bei Sehenswürdigkeiten allerdings deutlicher.



```{r, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
popdaily <- filter(popeur_approx, local_hour %in% 6:20, !(category %in% eur_low_obs_cat))
daily_country_cat_means <- group_by(popdaily, country, category, local_weekend, local_hour) %>%
    group_means_ci(pop_diff)

daily_cat_means <- group_by(daily_country_cat_means, category, local_weekend, local_hour) %>%
    group_means_ci(mean_pop_diff) %>% ungroup() %>% filter(n_mean_pop_diff > 1)

plot_daily_cat_means_ribbon(daily_cat_means, local_hour, mean_mean_pop_diff, lwr_mean_pop_diff, upr_mean_pop_diff,
                            category,
                            'Daily patterns of difference in places popularity in Europe by category',
                            collection_time, ribbon = FALSE)
```

[TODO: Beschriftungen auf deutsch]

Sowohl die Zahl der Infizierten, als auch die Maßnahmen gegen das Virus unterscheiden sich stark in den verschiedenen Ländern der Erde. Südkorea und Taiwan testen viel und haben strenge Quarantänemaßnahmen für positiv getestete Individuen, schränken sonst das öffentliche Leben aber weniger stark ein [TODO: Quellen hierfür]. Über den Zeitverlauf sieht man, dass werktags die Beliebtheitswerte an den gemessenen Orten sogar höher war, als üblich. Am Wochenende geht dieser Wert für diese Länder zurück, was bedeuten könnte, dass man in Taiwan und Südkorea bei Freizeitaktivitäten am Wochenende noch zurückhaltend ist, während das Arbeitsleben relativ normal weitergeht [zu spekulativ?]. In Spanien und Italien, beide sehr stark von der Ausbreitung des Virus betroffen und mit strengen Ausgangssperren in Kraft, ist die Mobilität im öffentlichen Raum nach diesen Daten am geringsten und zwar auf einem konstanten Niveau. Interessant ist, dass die Werte von Schweden stark denen von Deutschland ähneln, obwohl in Schweden keine Kontaktsperre o.ä. Maßnahmen gelten sondern die Regierung auf "Eigenverantwortung" setzt [TODO: Quelle] – allerdings ist die Datenlage für Schweden auch noch sehr eingeschränkt. [TODO: Verlauf USA – mehr Daten abwarten]


```{r, fig.width=10, fig.height=5}
popcntrs <- filter(pop, country %in% c('Italy', 'Spain', 'Germany', 'Sweden', 'United States', 'Taiwan', 'Korea, South', 'Austria'))

cntrs_low_obs_days <- group_by(popcntrs, local_day) %>% count() %>% ungroup() %>%
    filter(n < 600) %>% pull(local_day)

popcntrs_filt <- filter(popcntrs, !(local_day %in% cntrs_low_obs_days))
ts_cntrs_cat_daily_means <- group_by(popcntrs_filt, local_day, country, category) %>%
    group_means_ci(pop_diff) %>% ungroup()

ts_cntrs_daily_means <- group_by(ts_cntrs_cat_daily_means, local_day, country) %>%
    group_means_ci(mean_pop_diff) %>% ungroup()


plot_country_daily_means(ts_cntrs_daily_means, local_day, mean_mean_pop_diff,
                         lwr_mean_pop_diff, upr_mean_pop_diff, country,
                         'Mean daily popularity difference per country over time',
                         collection_time, ribbon = FALSE)
```

[Hier auch noch mehr Daten mind. bis nächstes WE abwarten / TODO: Beschriftungen auf deutsch]

Leider konnten auch nicht genügend Daten in China gesammelt werden, um zu prüfen, wie sich die zuletzt angeordnete Aufhebung vieler Beschränkungen [TODO: Quelle] auf die Mobilität im öffentlichen Raum auswirkt. Es gilt abzuwarten, bis auch in Europa Einschränkungen gelockert werden können und wie sich das auf den Verlauf der Kurve auswirkt. Gehen die Menschen sofort und verstärkt nach draußen um ersehnte Aktivitäten nachzuholen, oder sind sie eher weiterhin verunsichert und vorsichtig?

[TODO: Text für Karte unten]

```{r, fig.width=10, fig.height=5, warning=FALSE, message=FALSE}
n_places_per_city <- distinct(pop, iso2, city, place_id) %>% count(iso2, city) %>% rename(n_places_per_city = n)
cities_cat_means <- group_by(pop, iso2, city, category) %>% group_means_ci(pop_diff) %>% ungroup()
cities_means <- group_by(cities_cat_means, iso2, city) %>% group_means_ci(mean_pop_diff) %>% ungroup()
cities_means <- left_join(cities_means, n_places_per_city, by = c('iso2', 'city')) %>%
    left_join(cities, by = c('iso2', 'city')) %>% filter(n_places_per_city >= 10)

plot_cities_map(cities_means, 'Mean popularity difference per city', collection_time, draw_labels = FALSE)
```

[TODO: Labels besser lesbar machen / Beschriftungen auf deutsch]

[TODO:
- Fazit
]
